<!DOCTYPE html>
<html>
<head>
    <title>OHIF Navigation Button Checker</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #00ff00;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #000;
            padding: 20px;
            border: 2px solid #00ff00;
            border-radius: 10px;
        }
        h1 { color: #00ff00; text-align: center; }
        .step {
            margin: 20px 0;
            padding: 15px;
            background: #0a0a0a;
            border-left: 4px solid #00ff00;
        }
        .code {
            background: #0a0a0a;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #333;
            border-radius: 5px;
            overflow-x: auto;
        }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
            font-weight: bold;
            margin: 5px;
        }
        button:hover {
            background: #00cc00;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning { color: #ffaa00; }
        #output {
            background: #0a0a0a;
            padding: 15px;
            margin: 20px 0;
            border: 1px solid #333;
            min-height: 100px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§­ OHIF Navigation Button Diagnostic Tool</h1>
        
        <div class="step">
            <h2>Step 1: Open OHIF in Another Tab</h2>
            <p>Click this button to open OHIF:</p>
            <button onclick="window.open('http://localhost:3000', '_blank')">
                ğŸš€ Open OHIF Viewer
            </button>
        </div>

        <div class="step">
            <h2>Step 2: Run Diagnostic in OHIF Console</h2>
            <p>In OHIF tab, open browser console (F12) and paste this code:</p>
            <div class="code">
<pre>// Check if navigation button exists
const buttons = window.appConfig?.modes?.[0]?.toolbarButtons || [];
const navButton = buttons.find(b => b.id === 'RealTimeNavigation');

console.log('ğŸ” Navigation Button Check:');
console.log('âœ“ Total buttons:', buttons.length);
console.log('âœ“ Navigation button:', navButton ? 'âœ… FOUND' : 'âŒ NOT FOUND');

if (navButton) {
    console.log('Button details:', navButton);
}

// Check if commands exist
console.log('\nğŸ” Command Check:');
const cmdManager = window.commandsManager;
if (cmdManager) {
    console.log('âœ“ startNavigation:', cmdManager.getDefinition('startNavigation') ? 'âœ…' : 'âŒ');
    console.log('âœ“ stopNavigation:', cmdManager.getDefinition('stopNavigation') ? 'âœ…' : 'âŒ');
    console.log('âœ“ toggleNavigation:', cmdManager.getDefinition('toggleNavigation') ? 'âœ…' : 'âŒ');
}

// Check tracking service
console.log('\nğŸ” Service Check:');
if (window.servicesManager) {
    const { trackingService } = window.servicesManager.services;
    console.log('âœ“ TrackingService:', trackingService ? 'âœ… Available' : 'âŒ Not Available');
}

console.log('\nğŸ“‹ Summary: If all show âœ…, button should be visible!');
</pre>
            </div>
            <button onclick="copyToClipboard('diagnostic')">ğŸ“‹ Copy Diagnostic Code</button>
        </div>

        <div class="step">
            <h2>Step 3: Manual Navigation Test</h2>
            <p>If button is not visible, you can still test navigation via console:</p>
            <div class="code">
<pre>// In OHIF console (F12)

// Test navigation manually
commandsManager.runCommand('startNavigation', { mode: 'circular' });

// Wait and watch crosshair move!

// Stop after testing
commandsManager.runCommand('stopNavigation');
</pre>
            </div>
            <button onclick="copyToClipboard('manual')">ğŸ“‹ Copy Test Code</button>
        </div>

        <div class="step">
            <h2>Step 4: Check Browser Console for Errors</h2>
            <p>Look for any red errors in the console that mention:</p>
            <ul>
                <li>RealTimeNavigation</li>
                <li>TrackingService</li>
                <li>navigationController</li>
                <li>WebSocket</li>
            </ul>
        </div>

        <div class="step">
            <h2>Quick Actions</h2>
            <button onclick="window.open('http://localhost:3000', '_blank')">
                ğŸš€ Open OHIF
            </button>
            <button onclick="checkTrackingServer()">
                ğŸ“¡ Check Tracking Server
            </button>
            <button onclick="showInstructions()">
                ğŸ“– Show Instructions
            </button>
        </div>

        <div id="output"></div>
    </div>

    <script>
        function copyToClipboard(type) {
            const codes = {
                diagnostic: `// Check if navigation button exists
const buttons = window.appConfig?.modes?.[0]?.toolbarButtons || [];
const navButton = buttons.find(b => b.id === 'RealTimeNavigation');

console.log('ğŸ” Navigation Button Check:');
console.log('âœ“ Total buttons:', buttons.length);
console.log('âœ“ Navigation button:', navButton ? 'âœ… FOUND' : 'âŒ NOT FOUND');

if (navButton) {
    console.log('Button details:', navButton);
}

// Check if commands exist
console.log('\\nğŸ” Command Check:');
const cmdManager = window.commandsManager;
if (cmdManager) {
    console.log('âœ“ startNavigation:', cmdManager.getDefinition('startNavigation') ? 'âœ…' : 'âŒ');
    console.log('âœ“ stopNavigation:', cmdManager.getDefinition('stopNavigation') ? 'âœ…' : 'âŒ');
    console.log('âœ“ toggleNavigation:', cmdManager.getDefinition('toggleNavigation') ? 'âœ…' : 'âŒ');
}

// Check tracking service
console.log('\\nğŸ” Service Check:');
if (window.servicesManager) {
    const { trackingService } = window.servicesManager.services;
    console.log('âœ“ TrackingService:', trackingService ? 'âœ… Available' : 'âŒ Not Available');
}

console.log('\\nğŸ“‹ Summary: If all show âœ…, button should be visible!');`,
                manual: `// Test navigation manually
commandsManager.runCommand('startNavigation', { mode: 'circular' });

// Wait and watch crosshair move!

// Stop after testing
commandsManager.runCommand('stopNavigation');`
            };

            navigator.clipboard.writeText(codes[type]).then(() => {
                showOutput('âœ… Code copied to clipboard! Paste it in OHIF console (F12)', 'success');
            }).catch(() => {
                showOutput('âŒ Failed to copy. Please copy manually from the box above.', 'error');
            });
        }

        function checkTrackingServer() {
            fetch('http://localhost:8765')
                .then(() => {
                    showOutput('âœ… Tracking server is running on port 8765', 'success');
                })
                .catch(() => {
                    showOutput('âŒ Tracking server not responding. Run: python3 tracking_server.py', 'error');
                });
        }

        function showInstructions() {
            const instructions = `
ğŸ“‹ <strong>Where to Find the Button:</strong>

1. Look at the TOP toolbar in OHIF
2. Find these buttons in order:
   ğŸ“¤ Upload (Model Upload)
   ğŸ§­ Navigation â† <strong>THIS IS IT!</strong>
   ğŸ“ Layout

<strong>Button Details:</strong>
- Icon: Navigation/Compass icon (ğŸ§­)
- Tooltip: "Enable real-time surgical navigation with tracking (20Hz)"
- Action: Click to toggle navigation on/off

<strong>If Still Not Visible:</strong>
1. Hard refresh: Ctrl+Shift+R (Windows/Linux) or Cmd+Shift+R (Mac)
2. Clear cache: Open console (F12) â†’ Application â†’ Clear storage
3. Make sure you're in "Basic Viewer" mode
4. Check console for errors (F12)

<strong>Verify OHIF Restarted:</strong>
- OHIF should be running on http://localhost:3000
- Check: lsof -i :3000
- Restart if needed: pkill -f webpack && yarn dev
            `;
            showOutput(instructions, 'success');
        }

        function showOutput(message, type) {
            const output = document.getElementById('output');
            output.innerHTML = `<span class="${type}">${message}</span>`;
        }

        // Initial check
        window.onload = () => {
            showOutput('ğŸ‘‹ Welcome! Follow the steps above to diagnose the navigation button.', 'success');
        };
    </script>
</body>
</html>


