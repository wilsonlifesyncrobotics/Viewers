
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘         MEDICAL IMAGE COORDINATE SYSTEMS & VIEWPORT STATES                   â•‘
â•‘         Understanding DICOM â†’ World â†’ Camera â†’ Screen                        â•‘
â•‘                                                                              â•‘
â•‘         OHIF Viewer + Cornerstone3D + VTK.js Architecture                   â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SECTION 1: THE THREE WORLDS OF MEDICAL IMAGING                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   WORLD 1: DICOM    â”‚         â”‚  WORLD 2: PATIENT   â”‚         â”‚  WORLD 3: SCREEN    â”‚
    â”‚   (Stored Image)    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   (3D Space - LPS)  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  (Canvas Pixels)    â”‚
    â”‚                     â”‚         â”‚                     â”‚         â”‚                     â”‚
    â”‚  Units: Voxels(IJK) â”‚         â”‚  Units: Millimeters â”‚         â”‚  Units: Pixels      â”‚
    â”‚  Range: [0..511]Â³   â”‚         â”‚  Range: Â±1000mm     â”‚         â”‚  Range: [0..512]Â²  â”‚
    â”‚                     â”‚         â”‚                     â”‚         â”‚                     â”‚
    â”‚  Tags:              â”‚         â”‚  Properties:        â”‚         â”‚  Properties:        â”‚
    â”‚  â€¢ Position [x,y,z] â”‚         â”‚  â€¢ Origin           â”‚         â”‚  â€¢ Width, Height    â”‚
    â”‚  â€¢ Orientation [6]  â”‚         â”‚  â€¢ Direction Matrix â”‚         â”‚  â€¢ Device Pixels    â”‚
    â”‚  â€¢ Spacing [3]      â”‚         â”‚  â€¢ Shared Frame     â”‚         â”‚  â€¢ ViewportID       â”‚
    â”‚  â€¢ PixelData        â”‚         â”‚  â€¢ All viewports    â”‚         â”‚  â€¢ Canvas element   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â•‘                                   â•‘                                   â•‘
           â•‘ Transform Matrix                  â•‘ Camera Transform                  â•‘
           â•‘ M = DÂ·S + Origin                  â•‘ View Matrix                       â•‘
           â–¼                                   â–¼                                   â–¼
    indexToWorld([i,j,k])            Camera Properties              worldToCanvas([x,y,z])
    â†’ [x, y, z] mm                   â€¢ position, focalPoint         â†’ [px, py]
                                     â€¢ viewUp, viewPlaneNormal
                                     â€¢ parallelScale


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SECTION 2: DICOM LPS COORDINATE SYSTEM (Patient Space)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    Patient Lying on CT/MRI Table
                    (Looking from foot of bed)

                          S (Superior) - Head Up
                               â†‘  +Z
                               â”‚
                               â”‚
                 â•±â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²
                â•±              â”‚              â•²
               â•±               â”‚               â•²
              â•±         Coronal Plane          â•²
             â•±          (Front/Back)            â•²
            â•±                 â”‚                  â•²
    L â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â—â”€â”€â”€â”€â”€ R
    Left   â”‚   Axial Plane    â”‚  Axial Plane     â”‚   Right
    +X     â”‚   (Top/Bottom)   â”‚                  â”‚   -X
            â•²                 â”‚                  â•±
             â•²                â”‚                 â•±
              â•²               â”‚                â•±
               â•²    Sagittal Plane            â•±
                â•²   (Left/Right)             â•±
                 â•²              â”‚            â•±
                  â•²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•±
                                â”‚
                                â”‚ +Y
                                â†“
                        P (Posterior) - Back

    Origin: Usually at center or corner of image volume
    All measurements in millimeters (mm)

    STANDARD MPR VIEWS:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   View      â”‚  viewPlaneNormal     â”‚      viewUp          â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  Axial      â”‚  [0, 0, 1] (â†’S)     â”‚  [0, -1, 0] (â†’A)    â”‚
    â”‚  Sagittal   â”‚  [1, 0, 0] (â†’L)     â”‚  [0, 0, 1] (â†’S)     â”‚
    â”‚  Coronal    â”‚  [0, 1, 0] (â†’P)     â”‚  [0, 0, 1] (â†’S)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SECTION 3: TRANSFORMATION PIPELINE (IJK â†’ World â†’ Camera â†’ Screen)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    STEP 1: IJK to World Transformation
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Input: Voxel Index [i, j, k] = [128, 256, 50]

           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚   CT Volume    â”‚
           â”‚   512Ã—512Ã—200  â”‚
           â”‚                â”‚       Direction Matrix (D):
           â”‚   kâ†’  â•±â”Œâ”€â”€â”€â”€â”  â”‚       â”Œ                    â”
           â”‚      â•± â”‚    â”‚  â”‚       â”‚ 1.0  0.0  0.0     â”‚ â† Row direction
           â”‚     â•±  â”‚ â—  â”‚  â”‚       â”‚ 0.0  1.0  0.0     â”‚ â† Column direction
           â”‚ jâ†’ â”‚   â”‚[i,j]â”‚ â”‚       â”‚ 0.0  0.0  1.0     â”‚ â† Slice direction
           â”‚    â”‚   â””â”€â”€â”€â”€â”˜  â”‚       â””                    â”˜
           â”‚    â†“ iâ†’        â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       Spacing (S): [0.5, 0.5, 1.0] mm
                                    Origin (O): [-100, -100, -800] mm

    Formula:  World = Origin + Direction Â· Spacing Â· IJK

    Calculate:
        X = -100 + (1.0Ã—0.5Ã—128) + (0.0Ã—0.5Ã—256) + (0.0Ã—1.0Ã—50) = -36 mm
        Y = -100 + (0.0Ã—0.5Ã—128) + (1.0Ã—0.5Ã—256) + (0.0Ã—1.0Ã—50) =  28 mm
        Z = -800 + (0.0Ã—0.5Ã—128) + (0.0Ã—0.5Ã—256) + (1.0Ã—1.0Ã—50) = -750 mm

    Output: World Position [-36, 28, -750] mm in LPS coordinates


    STEP 2: Camera Transformation
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Camera Setup:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                            â”‚
    â”‚    position [0, 0, -650]                                  â”‚
    â”‚         â—                                                  â”‚
    â”‚         â”‚â•²                                                 â”‚
    â”‚         â”‚ â•²                                                â”‚
    â”‚         â”‚  â•²  viewPlaneNormal [0, 0, 1]                  â”‚
    â”‚         â”‚   â•²                                              â”‚
    â”‚         â”‚    â•²                                             â”‚
    â”‚         â”‚     â•²                                            â”‚
    â”‚         â”‚      â•²                                           â”‚
    â”‚         â”‚       â•²                                          â”‚
    â”‚         â”‚        â—  focalPoint [0, 0, -750]               â”‚
    â”‚         â”‚       â•±â”‚â•²                                        â”‚
    â”‚         â”‚      â•± â”‚ â•²  viewUp [0, -1, 0]                  â”‚
    â”‚         â”‚     â•±  â”‚  â†‘                                     â”‚
    â”‚         â”‚    â•±   â”‚  â”‚                                     â”‚
    â”‚         â”‚   â•±    â”‚  â”‚                                     â”‚
    â”‚         â”‚  â•±     â”‚  â”‚                                     â”‚
    â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  View Plane (Slice)       â”‚
    â”‚        â•±        â”‚     â”‚                                    â”‚
    â”‚       â•±         â”‚     â”‚                                    â”‚
    â”‚      â•±          â””â”€â”€â”€â”€â”€â”¼â”€â”€â†’ viewRight [1, 0, 0]           â”‚
    â”‚                       â”‚                                    â”‚
    â”‚                 parallelScale = 200 mm                     â”‚
    â”‚                 (view shows 400mm height)                  â”‚
    â”‚                                                            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    View Matrix Transforms:
    â€¢ World point â†’ Camera space
    â€¢ Apply: Translation by -position, then Rotation to camera axes
    â€¢ Result: Point expressed in camera's coordinate frame


    STEP 3: Projection to Normalized Device Coordinates (NDC)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Orthographic Projection:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  View Volume (What camera sees)            â”‚
    â”‚                                            â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚          top = parallelScale         â”‚ â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
    â”‚  â”‚  â”‚                                 â”‚  â”‚ â”‚
    â”‚  â”‚  â”‚     3D World Points             â”‚  â”‚ â”‚
    â”‚  â”‚  â”‚     Flattened to 2D             â”‚  â”‚ â”‚
    â”‚  â”‚  â”‚                                 â”‚  â”‚ â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
    â”‚  â”‚       bottom = -parallelScale        â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â”‚  â”‚â†    width = scale Ã— aspect     â†’â”‚      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
    Normalize to [-1, 1]Â³
            â†“
    NDC coordinates ready for viewport transform


    STEP 4: Viewport Transform to Canvas Pixels
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    NDC [-1, 1]Â² â†’ Canvas [0, width] Ã— [0, height]

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Canvas Element (512 Ã— 512 pixels)          â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
    â”‚  â”‚ (0,0)                          (512,0) â”‚ â”‚
    â”‚  â”‚                                         â”‚ â”‚
    â”‚  â”‚                                         â”‚ â”‚
    â”‚  â”‚         Rendered Medical Image          â”‚ â”‚
    â”‚  â”‚                                         â”‚ â”‚
    â”‚  â”‚                                         â”‚ â”‚
    â”‚  â”‚                                         â”‚ â”‚
    â”‚  â”‚ (0,512)                     (512,512)  â”‚ â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Formula:
        canvas_x = (ndc_x + 1) Ã— (canvas_width / 2)
        canvas_y = (1 - ndc_y) Ã— (canvas_height / 2)  â† Y-axis inverted


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SECTION 4: VIEWPORT STATE STRUCTURE                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Complete Recipe to Recreate a View:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ViewportState {                                                  â”‚
    â”‚                                                                   â”‚
    â”‚    ğŸ“ FrameOfReferenceUID                                         â”‚
    â”‚       "1.2.826.0.1.3680043.8.498.12744..."                       â”‚
    â”‚       â””â”€â†’ Identifies the coordinate system                        â”‚
    â”‚                                                                   â”‚
    â”‚    ğŸ“· Camera {                                                    â”‚
    â”‚       position: [77.49, 240.72, -877.47]    â† Where camera is   â”‚
    â”‚       focalPoint: [-1.27, 59.50, -791.40]   â† What it looks at  â”‚
    â”‚       viewUp: [0.22, -0.49, -0.84]          â† Up direction       â”‚
    â”‚       viewPlaneNormal: [0.37, 0.84, -0.40]  â† Look direction     â”‚
    â”‚       parallelScale: 234.21                  â† Zoom level        â”‚
    â”‚       rotation: 60.34Â°                       â† In-plane rotation â”‚
    â”‚    }                                                              â”‚
    â”‚       â”‚                                                           â”‚
    â”‚       â””â”€â†’ Defines WHERE and HOW we're looking                    â”‚
    â”‚                                                                   â”‚
    â”‚    ğŸ¯ ViewReference {                                             â”‚
    â”‚       sliceIndex: 760                        â† Slice #760/~1000  â”‚
    â”‚       volumeId: "cornerstoneStreamingImageVolume:..."            â”‚
    â”‚       planeRestriction: {                    â† Exact slice plane â”‚
    â”‚         point: [-1.27, 59.50, -791.40]                          â”‚
    â”‚         inPlaneVector1: [0.22, -0.49, -0.84]                    â”‚
    â”‚         inPlaneVector2: [0.90, -0.22, 0.37]                     â”‚
    â”‚       }                                                           â”‚
    â”‚    }                                                              â”‚
    â”‚       â”‚                                                           â”‚
    â”‚       â””â”€â†’ Defines WHICH slice and exact plane                    â”‚
    â”‚                                                                   â”‚
    â”‚    ğŸ¨ ViewPresentation {                                          â”‚
    â”‚       zoom: 1.0                              â† Additional zoom   â”‚
    â”‚       pan: [17.48, 40.22]                    â† Pan offset (mm)  â”‚
    â”‚       rotation: 60.34Â°                       â† Rotation angle    â”‚
    â”‚       flipHorizontal: false                  â† Mirror H?         â”‚
    â”‚       flipVertical: false                    â† Mirror V?         â”‚
    â”‚    }                                                              â”‚
    â”‚       â”‚                                                           â”‚
    â”‚       â””â”€â†’ Defines UI-level adjustments                           â”‚
    â”‚                                                                   â”‚
    â”‚    ğŸ“ Metadata {                                                  â”‚
    â”‚       viewportId: "mpr-axial"                                    â”‚
    â”‚       viewportType: "orthographic"                               â”‚
    â”‚       renderingEngineId: "OHIFCornerstoneRenderingEngine"       â”‚
    â”‚    }                                                              â”‚
    â”‚       â”‚                                                           â”‚
    â”‚       â””â”€â†’ Identifies which viewport                              â”‚
    â”‚                                                                   â”‚
    â”‚  }                                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SECTION 5: THREE SYNCHRONIZED VIEWPORTS (MPR)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    All three viewports view the SAME 3D volume from different angles:

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   AXIAL VIEWPORT    â”‚  SAGITTAL VIEWPORT  â”‚  CORONAL VIEWPORT   â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                     â”‚                     â”‚                     â”‚
    â”‚        R            â”‚        S            â”‚        S            â”‚
    â”‚        â†‘            â”‚        â†‘            â”‚        â†‘            â”‚
    â”‚    â”Œâ”€â”€â”€â”¼â”€â”€â”€â”        â”‚    â”Œâ”€â”€â”€â”¼â”€â”€â”€â”        â”‚    â”Œâ”€â”€â”€â”¼â”€â”€â”€â”        â”‚
    â”‚    â”‚   â”‚   â”‚        â”‚    â”‚   â”‚   â”‚        â”‚    â”‚   â”‚   â”‚        â”‚
    â”‚    â”‚   â”‚   â”‚        â”‚    â”‚   â”‚   â”‚        â”‚    â”‚   â”‚   â”‚        â”‚
    â”‚  P â—â”€â”€â”€â”¼â”€â”€â”€â— A      â”‚  P â—â”€â”€â”€â”¼â”€â”€â”€â— A      â”‚  L â—â”€â”€â”€â”¼â”€â”€â”€â— R      â”‚
    â”‚    â”‚   â”‚   â”‚        â”‚    â”‚   â”‚   â”‚        â”‚    â”‚   â”‚   â”‚        â”‚
    â”‚    â”‚   â”‚   â”‚        â”‚    â”‚   â”‚   â”‚        â”‚    â”‚   â”‚   â”‚        â”‚
    â”‚    â””â”€â”€â”€â”¼â”€â”€â”€â”˜        â”‚    â””â”€â”€â”€â”¼â”€â”€â”€â”˜        â”‚    â””â”€â”€â”€â”¼â”€â”€â”€â”˜        â”‚
    â”‚        â†“            â”‚        â†“            â”‚        â†“            â”‚
    â”‚        L            â”‚        I            â”‚        I            â”‚
    â”‚                     â”‚                     â”‚                     â”‚
    â”‚  viewPlaneNormal:   â”‚  viewPlaneNormal:   â”‚  viewPlaneNormal:   â”‚
    â”‚  [0, 0, 1]          â”‚  [1, 0, 0]          â”‚  [0, 1, 0]          â”‚
    â”‚  (Looking down)     â”‚  (Looking from R)   â”‚  (Looking from back)â”‚
    â”‚                     â”‚                     â”‚                     â”‚
    â”‚  sliceIndex: 760    â”‚  sliceIndex: 550    â”‚  sliceIndex: 586    â”‚
    â”‚  rotation: 60.3Â°    â”‚  rotation: 0Â°       â”‚  rotation: 293.5Â°   â”‚
    â”‚  pan: [17.5, 40.2]  â”‚  pan: [-16.6, 0]    â”‚  pan: [27.0, -67.0] â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Shared Properties:
    â€¢ FrameOfReferenceUID: Same for all three
    â€¢ World coordinate system: LPS (shared)
    â€¢ Volume: Same CT/MRI data

    Different Properties:
    â€¢ viewPlaneNormal: Different viewing direction
    â€¢ sliceIndex: Different slice number
    â€¢ focalPoint: Different 3D position
    â€¢ rotation, pan: Different UI adjustments


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SECTION 6: KEY FORMULAS AND CALCULATIONS                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  1. IJK to World Transformation                                   â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Input:  [i, j, k] = voxel indices
    Output: [x, y, z] = world coordinates (mm)

    Matrix Form:
    â”Œ   â”   â”Œ                              â”   â”Œ   â”
    â”‚ x â”‚   â”‚ DxÂ·Sx  0      0      Ox     â”‚   â”‚ i â”‚
    â”‚ y â”‚ = â”‚ 0      DyÂ·Sy  0      Oy     â”‚ Ã— â”‚ j â”‚
    â”‚ z â”‚   â”‚ 0      0      DzÂ·Sz  Oz     â”‚   â”‚ k â”‚
    â”‚ 1 â”‚   â”‚ 0      0      0      1      â”‚   â”‚ 1 â”‚
    â””   â”˜   â””                              â”˜   â””   â”˜

    Where:
    â€¢ D = Direction matrix (3Ã—3, from ImageOrientationPatient)
    â€¢ S = Spacing [column, row, slice]
    â€¢ O = Origin (ImagePositionPatient)

    Code:
        const worldPos = imageData.indexToWorld([i, j, k], vec3.create());


    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  2. Camera View Right Vector                                      â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Input:  viewPlaneNormal = [nx, ny, nz]
            viewUp = [ux, uy, uz]
    Output: viewRight = [rx, ry, rz]

    Formula: viewRight = viewPlaneNormal Ã— viewUp  (cross product)

    â”Œ    â”   â”Œ                                        â”
    â”‚ rx â”‚   â”‚ nyÂ·uz - nzÂ·uy                         â”‚
    â”‚ ry â”‚ = â”‚ nzÂ·ux - nxÂ·uz                         â”‚
    â”‚ rz â”‚   â”‚ nxÂ·uy - nyÂ·ux                         â”‚
    â””    â”˜   â””                                        â”˜

    Code:
        const viewRight = vec3.cross(
            vec3.create(),
            camera.viewPlaneNormal,
            camera.viewUp
        );


    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  3. Camera to Focal Point Distance                                â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Input:  position = [px, py, pz]
            focalPoint = [fx, fy, fz]
    Output: distance (mm)

    Formula: distance = âˆš[(px-fx)Â² + (py-fy)Â² + (pz-fz)Â²]

    Code:
        const distance = vec3.distance(camera.position, camera.focalPoint);


    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  4. Visible Scene Dimensions                                      â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Input:  parallelScale (half-height in mm)
            canvas aspect ratio = width / height
    Output: visible width and height (mm)

    Formula:
        visibleHeight = 2 Ã— parallelScale
        visibleWidth = visibleHeight Ã— aspectRatio

    Example:
        parallelScale = 234.21 mm
        aspectRatio = 512 / 512 = 1.0
        visibleHeight = 2 Ã— 234.21 = 468.42 mm
        visibleWidth = 468.42 Ã— 1.0 = 468.42 mm


    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  5. Pan Operation (Move Focal Point)                              â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Input:  focalPoint = [fx, fy, fz]
            pan delta = [dx, dy] in mm
            viewUp, viewRight vectors
    Output: new focalPoint

    Formula:
        newFocalPoint = focalPoint + dxÂ·viewRight + dyÂ·viewUp

    Code:
        const newFocalPoint = vec3.create();
        vec3.scaleAndAdd(newFocalPoint, focalPoint, viewRight, dx);
        vec3.scaleAndAdd(newFocalPoint, newFocalPoint, viewUp, dy);


    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘  6. Zoom Operation (Change Parallel Scale)                        â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Input:  parallelScale (current)
            zoom factor (e.g., 0.8 = zoom in 20%)
    Output: new parallelScale

    Formula:
        newScale = parallelScale Ã— zoomFactor

    Zoom in (closer):  zoomFactor < 1.0 (e.g., 0.8)
    Zoom out (farther): zoomFactor > 1.0 (e.g., 1.2)

    Code:
        const newScale = camera.parallelScale * 0.8; // Zoom in 20%
        viewport.setCamera({ parallelScale: newScale });


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SECTION 7: COMMON OPERATIONS (API REFERENCE)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  GET RENDERING ENGINE & VIEWPORT                                â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  import { getRenderingEngine } from '@cornerstonejs/core';     â”‚
    â”‚                                                                 â”‚
    â”‚  const engine = getRenderingEngine('OHIFCornerstoneRenderingEngine');â”‚
    â”‚  const viewport = engine.getViewport('mpr-axial');             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  COORDINATE CONVERSIONS                                         â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  // IJK â†’ World                                                 â”‚
    â”‚  const imageData = viewport.getDefaultImageData();             â”‚
    â”‚  const worldPos = imageData.indexToWorld([i, j, k]);           â”‚
    â”‚                                                                 â”‚
    â”‚  // World â†’ IJK                                                 â”‚
    â”‚  const ijkPos = imageData.worldToIndex([x, y, z]);             â”‚
    â”‚                                                                 â”‚
    â”‚  // World â†’ Canvas                                              â”‚
    â”‚  const canvasPos = viewport.worldToCanvas([x, y, z]);          â”‚
    â”‚                                                                 â”‚
    â”‚  // Canvas â†’ World                                              â”‚
    â”‚  const worldPos = viewport.canvasToWorld([px, py]);            â”‚
    â”‚                                                                 â”‚
    â”‚  // Image â†’ World                                               â”‚
    â”‚  const worldPos = utilities.imageToWorldCoords(imageId, [x,y]);â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CAMERA OPERATIONS                                              â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  // Get camera                                                  â”‚
    â”‚  const camera = viewport.getCamera();                           â”‚
    â”‚                                                                 â”‚
    â”‚  // Set camera (partial update)                                 â”‚
    â”‚  viewport.setCamera({ focalPoint: [x, y, z] });                â”‚
    â”‚                                                                 â”‚
    â”‚  // Reset to default                                            â”‚
    â”‚  viewport.resetCamera();                                        â”‚
    â”‚                                                                 â”‚
    â”‚  // Set without events                                          â”‚
    â”‚  viewport.setCameraNoEvent(camera);                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  VIEWPORT STATE OPERATIONS                                      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚  // Save snapshot                                               â”‚
    â”‚  const snapshot = viewportStateService.saveSnapshot("View 1"); â”‚
    â”‚                                                                 â”‚
    â”‚  // Restore snapshot                                            â”‚
    â”‚  viewportStateService.restoreSnapshot("View 1");                â”‚
    â”‚                                                                 â”‚
    â”‚  // Get all snapshots                                           â”‚
    â”‚  const snapshots = viewportStateService.getAllSnapshots();     â”‚
    â”‚                                                                 â”‚
    â”‚  // Export/Import JSON                                          â”‚
    â”‚  const json = viewportStateService.exportJSON();                â”‚
    â”‚  viewportStateService.importJSON(jsonString);                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SECTION 8: DEBUGGING CHECKLIST                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    âœ“ Vector Validity:
      â–¡ viewPlaneNormal length â‰ˆ 1.0    (unit vector)
      â–¡ viewUp length â‰ˆ 1.0              (unit vector)
      â–¡ viewPlaneNormal Â· viewUp â‰ˆ 0.0   (perpendicular)

    âœ“ Camera Configuration:
      â–¡ Camera distance: 50-500mm        (reasonable for medical imaging)
      â–¡ parallelScale: 100-500mm         (typical range)
      â–¡ focalPoint within volume bounds
      â–¡ position not at focalPoint

    âœ“ Coordinate System:
      â–¡ FrameOfReferenceUID same across viewports
      â–¡ Origin within reasonable range   (Â±1000mm)
      â–¡ Spacing positive values          (>0)
      â–¡ Direction matrix orthonormal

    âœ“ Viewport State:
      â–¡ sliceIndex within [0, numSlices-1]
      â–¡ zoom > 0
      â–¡ pan values reasonable (< 1000mm)
      â–¡ rotation in [0, 360] degrees


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                              â•‘
â•‘  SUMMARY: The Complete Journey                                              â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â•‘
â•‘                                                                              â•‘
â•‘  1. DICOM file contains: Pixels + Position + Orientation + Spacing          â•‘
â•‘     â””â”€â†’ Stored as voxel indices (IJK)                                       â•‘
â•‘                                                                              â•‘
â•‘  2. Build transformation matrix: Direction Â· Spacing + Origin               â•‘
â•‘     â””â”€â†’ Converts IJK to World (LPS mm)                                      â•‘
â•‘                                                                              â•‘
â•‘  3. VTK.js creates imageData with geometry                                  â•‘
â•‘     â””â”€â†’ All voxels now have world coordinates                               â•‘
â•‘                                                                              â•‘
â•‘  4. Camera defines viewing transformation                                    â•‘
â•‘     â””â”€â†’ position, focalPoint, viewUp, viewPlaneNormal, parallelScale       â•‘
â•‘                                                                              â•‘
â•‘  5. VTK rendering pipeline executes                                         â•‘
â•‘     â””â”€â†’ Reslice, Transform, Project, Rasterize                              â•‘
â•‘                                                                              â•‘
â•‘  6. Canvas displays final 2D image                                           â•‘
â•‘     â””â”€â†’ User sees medical image on screen                                   â•‘
â•‘                                                                              â•‘
â•‘  7. Viewport state captures everything                                       â•‘
â•‘     â””â”€â†’ Can restore exact view later                                        â•‘
â•‘                                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Related Documents:                                                          â•‘
â•‘  â€¢ COORDINATE_SYSTEMS_AND_VIEWPORT_STATES_GUIDE.md - Comprehensive guide    â•‘
â•‘  â€¢ VISUAL_TEACHING_GUIDE.md - Step-by-step tutorial                         â•‘
â•‘  â€¢ QUICK_REFERENCE_COORDINATE_SYSTEMS.md - Quick lookup                     â•‘
â•‘  â€¢ viewport-snapshots-2025-10-31T05-22-44.json - Your actual snapshot data  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
